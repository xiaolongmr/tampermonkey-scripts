# 导航站数据404检测工具

## 工具介绍

这是一个基于Tampermonkey的脚本工具，用于自动检测导航网站中收录的链接有效性，识别并报告那些无法访问或返回404错误的网站。该工具可以帮助导航网站管理员或维护者及时发现并更新失效链接，提高用户体验。

## 功能特点

- **自动提取网站信息**：使用指定的CSS选择器自动提取导航网站中的网站名称、图标链接和网站链接
- **批量链接检测**：支持并发检测多个网站链接，提高检测效率
- **详细检测报告**：生成包含统计信息和失败链接详情的可视化报告
- **灵活配置**：可自定义并发数量、超时时间、重试次数等参数
- **数据导出**：支持将提取的网站数据导出为JSON格式
- **错误处理**：内置完善的错误处理机制，可处理网络超时、连接错误等异常情况

## 安装方法

1. 确保已在浏览器中安装 [Tampermonkey](https://www.tampermonkey.net/) 扩展
2. 打开 Tampermonkey 扩展，点击「添加新脚本」
3. 复制 `导航站数据404检测.js` 文件的全部内容，粘贴到编辑器中
4. 点击「文件」→「保存」或按 `Ctrl+S` 保存脚本
5. 脚本将自动启用，适用于所有网站

## 使用方法

1. 访问目标导航网站
2. 点击浏览器工具栏中的 Tampermonkey 图标
3. 在下拉菜单中选择「导航站数据404检测工具」
4. 选择以下功能之一：
   - **开始检测链接**：启动链接有效性检测过程
   - **导出网站数据**：将提取的网站信息导出为JSON格式
   - **配置**：调整脚本的工作参数

### 检测流程说明

1. 脚本会使用配置的CSS选择器提取页面中的网站信息
2. 显示检测进度面板，展示当前检测状态
3. 完成检测后，生成详细的检测报告
4. 报告中包含统计信息和无法访问的网站列表

## 配置参数说明

脚本提供了以下可配置参数：

- **并发请求数量**：同时进行检测的链接数量（默认为5，范围1-20）
  - 较高的并发数可以提高检测速度，但可能对目标服务器造成较大负载
  - 建议根据实际情况进行调整，一般不超过10

- **超时时间**：每个链接的最长检测时间（毫秒，默认为10000，范围1000-30000）
  - 对于访问较慢的网站，可适当增加超时时间

- **重试次数**：链接检测失败后的重试次数（默认为2，范围0-5）
  - 增加重试次数可以降低网络波动导致的误判率

## CSS选择器配置

脚本默认使用以下CSS选择器提取网站信息：

```javascript
SELECTORS: {
    // 网站名称选择器
    NAME: '.box-card a .item .logo span',
    // 网站图标选择器
    ICON: '.box-card a .item .logo img',
    // 网站链接选择器
    LINK: '.box-card a'
}
```

如果目标导航网站的HTML结构与默认选择器不匹配，需要手动修改脚本中的选择器配置。修改方法：

1. 在Tampermonkey中编辑脚本
2. 找到`CONFIG`对象中的`SELECTORS`部分
3. 根据目标网站的实际HTML结构更新选择器
4. 保存脚本并刷新目标网站

## 链接检测原理

由于浏览器的安全限制（同源策略），脚本不能直接对跨域资源执行完整的HTTP请求并获取状态码。为了解决这个问题，脚本使用了以下方法：

1. 使用HTML的`Image`对象发起请求，这是一种常见的跨域检测方法
2. 通过监听`onload`、`onerror`事件和设置超时来判断链接状态
3. 对于失败的请求，根据配置进行自动重试

**注意**：这种方法可能会产生一定的误判，特别是对于那些返回200但内容不正确的网站。这是由于浏览器安全限制导致的技术局限性。

## 性能优化建议

1. **针对大量链接的情况**：
   - 适当降低并发请求数量，避免被目标网站误认为是恶意请求
   - 增加请求延迟时间，减轻服务器负载

2. **针对网络不稳定的情况**：
   - 增加超时时间和重试次数
   - 考虑分批检测大量链接

## 常见问题解答

### Q: 为什么脚本没有找到任何网站数据？
A: 可能是CSS选择器与目标网站的HTML结构不匹配。请查看浏览器控制台的错误信息，并根据目标网站的实际结构修改脚本中的选择器。

### Q: 为什么有些实际上可以访问的网站被标记为失败？
A: 这可能是由于以下原因：
- 目标网站设置了防盗链，阻止了`Image`对象的请求
- 网络延迟导致请求超时
- 网站返回了非图片内容，但脚本使用`Image`对象进行检测

### Q: 检测速度太慢，如何提高？
A: 可以尝试增加并发请求数量，减少请求延迟时间，但请注意不要设置过高，以免对服务器造成过大压力或被反爬机制拦截。

## 注意事项

1. 请不要滥用此工具，避免对目标网站造成过大的访问压力
2. 检测结果仅供参考，可能存在一定的误判
3. 对于重要的网站，请手动验证其可访问性
4. 该工具仅用于检测链接有效性，不会修改或收集任何网站内容

## 作者信息

- 作者：小张
- 博客：https://blog.z-l.top/
- GitHub：https://github.com/xiaolongmr

## 许可证

该项目采用MIT许可证 - 详情请查看LICENSE文件