## 目标

* 为现有 Tampermonkey 脚本添加一个可视化设置界面（覆盖层弹窗），支持开关与下拉选项，并持久化配置。

* 设置项直接影响脚本的去水印逻辑（JSON.parse hook），且兼容后续“下载格式”“命名规则”等扩展。

## 设置内容

* 去水印开关：三项复选（下载图、大图预览、聊天缩略图）。

* 去水印方案：下拉（“LauZz方案默认”“拼接方案（爱吃馍）”），默认前者，后者还没有做出来，豆包去水印脚本.js目前使用的是LauZz方案默认。

* 下载图片格式：下拉（PNG/WEBP/JPG），先持久化占位，后续下载逻辑可读取。

* 图片命名格式：点击“图片名称格式”打开命名弹窗，提供“对话名+对话id+序号/时间戳”“对话名+时间戳/序号”“自定义前缀+时间戳/序号”“序号/时间戳+自定义后缀”等预设，并提供前/后缀输入框。

* 关于、分享、版本号、更新日志、讨论等入口（可链接到您提供的页面），致谢名单可作为独立页面入口（参考花瓣去水印的致谢名单的引入方式以及致谢名单数据加载方式）。

## UI 组合与来源

* 主界面基于 `svg to html/设置首选项.html` 的结构与视觉，改为 Tailwind 组件化布局

* 下拉面板分别复用：

  * `svg to html/下载图片格式下拉列表.html`

  * `svg to html/去水印方案下拉列表.html`

* 命名规则弹窗复用并简化：`svg to html/请选择图片命名格式弹窗.html`

* 致谢名单单独入口复用：`svg to html/致谢名单.html`

* 所有碎片以组件方式插入到同一个覆盖层中，避免多个独立页面跳转；如需独立预览可通过您提供的本地 URL 访问。

## 技术实现

* Userscript 头部补充：作者、license、namespace、icon、`@grant GM_addStyle/GM_getValue/GM_setValue/GM_registerMenuCommand`。

* 通过 `GM_registerMenuCommand('设置首选项', ...)` 挂载菜单，点击后创建一个覆盖层（`<div id="doubao-rm-settings">`）并插入到页面 `body`；再次点击或关闭按钮隐藏。

* CSS：优先加载 Tailwind（BootCDN 可用则使用，失败回退至 `cdn.tailwindcss.com`），同时用 `GM_addStyle` 注入少量基础样式（遮罩、层级、动画）。

* 状态管理：

  * 使用 `GM_getValue/GM_setValue` 持久化配置（键名如 `doubao_rm_settings`），含：`{ enableOri:true, enablePreview:true, enableThumb:true, scheme:'raw', format:'png', nameRule:'dialog+id+seq', prefix:'', suffix:'' }`。

  * 设置界面控件与状态双向绑定（初始化读取，变更即保存）。

* Hook 调整：

  * 保留原有 `JSON.parse` 重载；在检测到 `creations` 数据时，按开关与方案逐项赋值：

    * `scheme:'raw'`：将 `image_ori/image_preview/image_thumb` 的 `url` 都替换为 `image_ori_raw.url`，依据三开关分别替换。

    * `scheme:'concat'`（拼接方案）：预留实现（后续将按像素拼接或替换水印遮挡区域）；当前版本可临时与 `raw` 一致或仅替换 `preview`，并在 UI 内标注“实验性”。

  * 非匹配响应不改动，保持安全。

## 交互与可用性

* 界面默认居中且自适配宽度，Esc/点击遮罩关闭；保存即时生效，无需刷新。

* 提示说明：

  * 浏览器下载目录不可由脚本强制指定（安全限制），UI 显示当前建议路径与说明即可。

  * 若 Tailwind 外链被拦截，仍有基础样式保证可用。

* 可选新手引导：如界面较复杂，可按需引入 Driver.js（CDN IIFE + CSS），在首次打开设置时引导。

## 兼容与安全

* 保持对原站点的最低侵入：仅在用户触发时插入覆盖层；不修改页面业务逻辑。

* 命名规则与下载格式先持久化，不在当前版本触发下载行为，避免与站点权限冲突。

* 代码不存储任何敏感信息；不输出 URL 中的 token 等。

## 验证方案

* 本地模拟 `creations` JSON 片段，在三开关不同组合下验证 URL 替换是否符合配置。

* 在豆包页面实际对话中切换方案与开关，观察预览、大图、聊天缩略图是否均无水印（依站点接口返回内容验证）。

## 变更清单（实施时）

* 更新 Userscript 头部为规范版本（补全 `@grant`、`@namespace`、`@icon`）。

* 注入设置覆盖层组件、下拉与弹窗组件、状态持久化逻辑。

* 调整 `JSON.parse` hook：按设置生效、兼容无改动场景。

## 后续扩展

* 绑定“下载格式/命名规则”到实际下载功能（批量导出）；

* 添加“更新日志”“致谢名单”页面入口的内嵌渲染或新窗口打开。

请确认以上方案，我将据此直接在脚本中实现并回传完整代码。
